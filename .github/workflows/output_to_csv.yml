name: Extract table values
on:
  push:
    branches:
      - main
jobs:
  extract:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repo
        uses: actions/checkout@v3
      - name: Remove existing parameter_list.csv
        uses: JesseTG/rm@v1.0.3
        with:
          path: /parameter_list.csv
      - name: Extract all platforms parameters from README.md
        run: |
          table=$(awk -F '|' '{if (start && !end) print $2} /---start---/{start=1} /---end---/{end=1}' README.md | tail -n+4 | sed 's/`//g' | sed 's/ //g' | sed -z 's/\n/,/g;s/,$/\n/' | sed 's/..$//')
          echo "$table"
          # Save the output as parameter_list.csv
          echo "$table" > parameter_list.csv
      - name: Commit and push parameter_list.csv
        run: |
          git config --global user.email "github@henriksoderlund.com"
          git config --global user.name "HENRIK SÃ–DERLUND"
          git add parameter_list.csv
          git commit -m 'Automatically generate and add parameter_list.csv from README'
          git push origin main
